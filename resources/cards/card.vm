<!DOCTYPE html>
<link rel="stylesheet" href="card.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
<link rel="stylesheet" href="https://cdn.materialdesignicons.com/2.0.46/css/materialdesignicons.min.css">
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">

#macro(figure $card)
    #foreach($figure in $card.figure_parsed)
        #figure_embed($figure.filename, $figure.source, $figure.top, $figure.right, $figure.bottom, $figure.left, $figure.size, $figure.rotate, $figure.color)
    #end
#end
#macro(figure_embed $figure $source $top $right $bottom $left $size $rotate $color)
    #if($source == "material-icons")
        <!--https://material.io/icons/-->
        <i class="material-icons figure" #figure_style($top, $right, $bottom, $left, $size, $rotate)>$escape_html($label)</i>
    #elseif($source == "mdi")
        <!--https://materialdesignicons.com/-->
        <i class="mdi mdi-$escape_html($figure)" #figure_style($top, $right, $bottom, $left, $size, $rotate)></i>
    #elseif($source == "fa")
        <!--http://fontawesome.io/icons/-->
        <i class="fa fa-$escape_html($figure)" #figure_style($top, $right, $bottom, $left, $size, $rotate)></i>
    #elseif($source == "svg")
        <!--/cards/svg-->
        <!--<img class="svg_filter" src="/svg/${escape_html($figure)}.svg">-->
        #if($color)
            #set($color = "?color=${color}")
        #end
        <img src="/svg/${escape_html($figure)}.svg$color" #figure_style($top, $right, $bottom, $left, $size, $rotate)>
    #end
#end
#macro(figure_style $top $right $bottom $left $size $rotate)
    style="padding:${top}px ${right}px ${bottom}px ${left}px;width:calc(100% - ${size}px);height:calc(100% - ${size}px);transform:rotate(${rotate}deg)"
#end
#macro(specialFlags $card)
    #if($card.has_flag("mastery"))
        <big>
            &#x274F; &#x274F; &#x274F; &#x274F; &#x274F;
            &#x274F; &#x274F; &#x274F; &#x274F; &#x274F;
        </big>
    #end
    #if($card.has_flag("pokehum"))
        <big>
            Name: ______________
        </big>
    #end
#end
#macro(handlePower $text)
    #if($text.__contains__("*"))
        #statIcons($escape_html($text.split("*").get(0)))
        #set($text = $escape_html($text.split("*").get(1)))
    #else
        <img src="../svg/game-icons/power-button.svg?color=292A30">
    #end
    <div class="list">
        #foreach($line in $text.split("/"))
            <small class="listelem">$escape_html($line)</small>
        #end
    </div>
#end
#macro(statIcons $text)
    #foreach($word in $text.split())
        #if($word == "BODY")
            <img src="../svg/game-icons/strong.svg?color=292A30">
        #elseif($word == "TEC")
            <img src="../svg/game-icons/gear-hammer.svg?color=292A30">
        #elseif($word == "MAG")
            <img src="../svg/game-icons/fairy-wand.svg?color=292A30">
        #elseif($word == "ATT")
            <img src="../svg/game-icons/broadsword.svg?color=292A30">
        #else
            $word
        #end
    #end
#end
#macro(handleCostUnit $cost $match)
    <div class="costunit">
        $escape_html($strip_unit($cost, $match)) $escape_html($match)
    </div>
#end
#macro(effectList $effects)
    <ul>
        #foreach($effect in $effects)
            #if($effect)
                <li>$escape_html($effect)</li>
            #end
        #end
    </ul>
#end
#macro(cardClasses $card)
    #if($card_is_item)item #end
    #if($card.effects)effects #end
    #if($card_has_emblem)emblem #end
    #if($card.cp)price #end
#end

<title>Cards</title>

#foreach($card in $cards)

#set($card_is_item = false)
#foreach($flag in ["Consumable", "Title", "Food", "Trinket", "Crafting Material", "Collectible", "Alchemy Material", "Ammo", "Splash", "Thrown", "Draw Card", "Passive", "Melee Weapon", "Arc Weapon", "LoS Weapon"])
    #if($card.flags.__contains__($flag)) #set($card_is_item = true) #end
    #if($card.flags.__contains__($flag.lower())) #set($card_is_item = true) #end
#end

#set($card_has_emblem = false)
#foreach($flag in ["Mastered"])
    #if($card.flags.__contains__($flag)) #set($card_has_emblem = true) #end
    #if($card.flags.__contains__($flag.lower())) #set($card_has_emblem = true) #end
#end

<article id="$escape_html($card.filename)" class="#cardClasses($card)" onclick="location.href='creator?filename=$escape_html($card.filename)'">
    <div class="title"><h1>$escape_html($card.title)</h1></div>
    #if($card.cp)
        <div class="cp"><img src="../svg/game-icons/seven-pointed-star.svg?color=292A30"></div>
        <div class="cp text">$escape_html($card.cp)</div>
    #end
    #if($card.has_flag("Mastered"))
        <div class="emblem"><img src="../svg/game-icons/stars-stack.svg?color=292A30"></div>
    #end
    <figure>
        #figure($card)
    </figure>
    #if($card.effects && ! $card_is_item)
        #effectList($card.effects)
    #end

    <section>
        #if($card.stats.power)
            #handlePower($card.stats.power)
        #elseif($card.power)
            #handlePower($card.power)
        #end

        #if($card.stats.duration and $card.stats.duration != 0)
            <img src="../svg/game-icons/sands-of-time.svg?color=292A30">
            <div class="value">$escape_html($card.stats.duration)</div>
        #end

        #if($card.cost)
            <img class="cost" src="../svg/game-icons/electric.svg?color=292A30">
            <div class="list cost">
            #foreach($cost in $card.cost.split(","))
                <div class="listelem">$escape_html($cost)</div>
            #end
            </div>
        #end

        #if($card.gp)
            <img class="price" src="../svg/game-icons/cash.svg?color=292A30">
            <div class="price">$card.gp</div>
        #end
    </section>

    <main>
        <div class="top">
            #if($card.steps)
                #foreach($item in $card.steps)
                    #if($item.startswith("+"))
                        <div class="steps">$escape_html($item)</div>
                    #else
                        <div class="description">$escape_html($item)</div>
                    #end
                #end
            #end
            #if($card.has_flag("discipline"))
                <div class="description discipline">Alternatively:</div>
                <div class="description">Discard this card instead of playing it, and draw a new card.</div>
            #end
            #if($card.effects && $card_is_item)
                #effectList($card.effects)
            #end
        </div>
        #if($card.description or $card.flags)
            <div class="bottom">
                #if($card.description)
                <small>
                    $escape_html($card.description)
                </small>
                #end
                #specialFlags($card)
            </div>
        #end
    </main>
    
</article>
#end

#if($was_saved)
<center class="message">The card has been saved</center>
#end
#if($was_deleted)
<center class="message">The card has been removed from storage</center>
#end
